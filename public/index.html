<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>SMS</title>
  <meta name="description" content="sms">
</head>

<style>
span {
  color: #cc2400;
}
</style>

<body>

  <h1>Auth User</h1>

  <h2>First: auth weibo and get sms</h2>
  <p>
    weibo permalink:
    <input id="weibo_permalink"></input> <br/>
    mobile number:
    <input name="mobile" id="mobile"></input> <br/>
    <button id="submit">get sms</button>
    <span id="mobileResult"></span>
  </p>

  <h2>Second: verify sms code</h2>
  <p>
    code:
    <input name="code" id="code"></input>
    <br/>
    <button id="verify">verify</button>
    <span id="codeResult"></span>
  </p>
</body>
</html>

<script type="application/javascript" src="/javascripts/jquery.js"></script>

<script>
$(function(){

  var $mobileResult = $("#mobileResult");

  $("#submit").click(function(){
    var mobile = $("#mobile").val();
    var weibo_permalink = $("#weibo_permalink").val();
    if (mobile == ""){
      $mobileResult.text("pls input your mobile number!");
      return;
    }
    if (weibo_permalink == ""){
      $mobileResult.text("pls input weibo_permalink");
      return;
    }
    $.ajax({
      url: "/submit_sms",
      type: "POST",
      data: { weibo_permalink: weibo_permalink, sms_number: mobile, signature_request: "" },
      success: function(ret){
        $mobileResult.text(ret.status);
      }
    });
  });

  var $codeResult = $("#codeResult");

  $("#verify").click(function(){
    var code = $("#code").val();
    if (code == ""){
      $codeResult.text("pls input code from your sms");
      return;
    }
    $.ajax({
      url: "/verify_sms",
      type: "POST",
      data: { sms_verification: code },
      success: function(ret){
        $codeResult.text(ret.status || ret.signature);
      }
    });
  });
});
</script>



